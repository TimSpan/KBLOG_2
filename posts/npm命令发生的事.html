<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>npm run 发生了什么 | KevinBlog</title>
    <meta name="description" content="npm run 发生了什么">
    <link rel="stylesheet" href="/KBLOG_2/assets/style.699c32a0.css">
    <link rel="modulepreload" href="/KBLOG_2/assets/Home.94f814a0.js">
    <link rel="modulepreload" href="/KBLOG_2/assets/app.bb1174c4.js">
    <link rel="modulepreload" href="/KBLOG_2/assets/posts_npm命令发生的事.md.4f1129ec.lean.js">
    
    <link rel="icon" type="image/png" href="/haimianbaobao.png">
  <meta name="author" content="Kevin">
  <meta property="og:title" content="Home">
  <meta property="og:description" content="Home of Kevin">
  <meta name="twitter:title" content="npm run 发生了什么 | KevinBlog">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><div class="no-sidebar theme"><header class="nav-bar" data-v-40587210><div class="sidebar-button" data-v-40587210><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/KBLOG_2/" aria-label="KevinBlog, back to home" data-v-40587210 data-v-016a8bd8><img class="logo" src="/KBLOG_2/haimianbaobao.png" alt="Logo" data-v-016a8bd8> KevinBlog</a><div class="flex-grow" data-v-40587210></div><div class="nav" data-v-40587210><nav class="nav-links" data-v-40587210 data-v-35b91e7e><!--[--><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/KBLOG_2/" data-v-49fe041d>🏡Home <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/KBLOG_2/tags" data-v-49fe041d>🔖Tags <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/KBLOG_2/archives" data-v-49fe041d>📃Archives <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item isExternal" href="https://vue3js.cn/interview/" target="_blank" rel="noopener noreferrer" data-v-49fe041d>面试官问系列 <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-49fe041d><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item isExternal" href="https://www.yuque.com/cuggz/interview/gme0bw" target="_blank" rel="noopener noreferrer" data-v-49fe041d>语雀前端面试题总结 <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-49fe041d><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item isExternal" href="https://www.html5iq.com/index.html" target="_blank" rel="noopener noreferrer" data-v-49fe041d>前端知识库 <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-49fe041d><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--[--><div class="toggleTheme" data-v-f68cd400><div class="light" data-v-f68cd400>🔆</div></div><!--]--><!--]--></header><aside class="sidebar" data-v-17c48e2f><nav class="nav-links nav" data-v-17c48e2f data-v-35b91e7e><!--[--><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/KBLOG_2/" data-v-49fe041d>🏡Home <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/KBLOG_2/tags" data-v-49fe041d>🔖Tags <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item" href="/KBLOG_2/archives" data-v-49fe041d>📃Archives <!----></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item isExternal" href="https://vue3js.cn/interview/" target="_blank" rel="noopener noreferrer" data-v-49fe041d>面试官问系列 <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-49fe041d><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item isExternal" href="https://www.yuque.com/cuggz/interview/gme0bw" target="_blank" rel="noopener noreferrer" data-v-49fe041d>语雀前端面试题总结 <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-49fe041d><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="item" data-v-35b91e7e><div class="nav-link" data-v-35b91e7e data-v-49fe041d><a class="item isExternal" href="https://www.html5iq.com/index.html" target="_blank" rel="noopener noreferrer" data-v-49fe041d>前端知识库 <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-49fe041d><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><!----><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-8fcebc32><div class="container" data-v-8fcebc32><!--[--><!--[--><!----><!--]--><!--[--><h1 class="title" data-v-cda39220></h1><div class="category" data-v-4c27e764><ul data-v-4c27e764><!--[--><li class="header" data-v-4c27e764><a href="#当你运行npm-run命令时，会发生什么" class="header-h1" data-v-4c27e764>当你运行npm run命令时，会发生什么</a><!----></li><li class="header" data-v-4c27e764><a href="#script字段" class="header-h1" data-v-4c27e764>script字段</a><!----></li><li class="header" data-v-4c27e764><a href="#bin目录下的软链接" class="header-h1" data-v-4c27e764>.bin目录下的软链接</a><!----></li><!--]--></ul></div><!--]--><!--]--><div style="position:relative;" class="content" data-v-8fcebc32><div><h1 id="npm命令发生的事" tabindex="-1">npm命令发生的事 <a class="header-anchor" href="#npm命令发生的事" aria-hidden="true">#</a></h1><h2 id="当你运行npm-run命令时，会发生什么" tabindex="-1">当你运行npm run命令时，会发生什么 <a class="header-anchor" href="#当你运行npm-run命令时，会发生什么" aria-hidden="true">#</a></h2><h2 id="script字段" tabindex="-1">script字段 <a class="header-anchor" href="#script字段" aria-hidden="true">#</a></h2><p>当我们用npm（node package manager）来管理JavaScript/TypeScript项目的时候，都会在项目的根目录下生成一个package.json文件。而这个文件里的script字段就是用于适配npm run XXX命令的。举个例子，像下图里package.json文件：</p><div class="language-json"><pre><code>  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite build&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;preview&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite preview&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>那么，当我们运行npm run build命令的时候，就会去scripts字段里找到build对应的vite build命令去执行。可能有小伙伴会问了，那为什么不能直接执行vite build命令呢？因为这样会报错，操作系统里只有npm相关的命令，不存在vite build这条命令；而我们在下载安装依赖的时候，会在node_modules/.bin目录下创建好名为vite的可执行文件：</p><p>.bin这个目录并不是任何npm包，其目录底下的可执行文件都是一个个软链接；其余node_modules目录下的文件夹都是一个个下载下来的依赖模块。</p><p>而在.bin目录下，一般针对一个依赖模块，会有3个可执行文件，没有后缀名的是对应Unix系的shell脚本，.cmd为后缀名的是windows bat脚本，.ps1为后缀名的则是PowerShell中可执行文件（可以跨平台），<strong>三者作用都是用node执行一个js文件</strong>。我们可以打开名为ng 的这个文件，看看里面的内容：</p><div class="language-js"><pre><code><span class="token hashbang comment">#!/bin/sh</span>
basedir<span class="token operator">=</span><span class="token function">$</span><span class="token punctuation">(</span>dirname <span class="token string">&quot;$(echo &quot;</span>$<span class="token number">0</span><span class="token string">&quot; | sed -e &#39;s,\\,/,g&#39;)&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">case</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">uname</span><span class="token template-punctuation string">`</span></span> <span class="token keyword">in</span>
    <span class="token operator">*</span><span class="token constant">CYGWIN</span><span class="token operator">*</span><span class="token operator">|</span><span class="token operator">*</span><span class="token constant">MINGW</span><span class="token operator">*</span><span class="token operator">|</span><span class="token operator">*</span><span class="token constant">MSYS</span><span class="token operator">*</span><span class="token punctuation">)</span> basedir<span class="token operator">=</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">cygpath -w &quot;$basedir&quot;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><span class="token punctuation">;</span>
esac

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">-</span>x <span class="token string">&quot;$basedir/node&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> then
  exec <span class="token string">&quot;$basedir/node&quot;</span>  <span class="token string">&quot;$basedir/../vite/bin/vite.js&quot;</span> <span class="token string">&quot;$@&quot;</span>
<span class="token keyword">else</span> 
  exec node  <span class="token string">&quot;$basedir/../vite/bin/vite.js&quot;</span> <span class="token string">&quot;$@&quot;</span>
fi

</code></pre></div><p>由此，我们得知，当我们运行npm run build命令的时候，虽然ng没有全局安装，但是npm会到./node_modules/.bin目录里找到vite.js文件作为node脚本来执行，也就是相当于执行了./node_modules/.bin/vite build命令（最后的build作为参数传入）。</p><h2 id="bin目录下的软链接" tabindex="-1">.bin目录下的软链接 <a class="header-anchor" href="#bin目录下的软链接" aria-hidden="true">#</a></h2><p>我们继续往下看，既然.bin目录下的执行文件是一个个软链接，那么这些软链接文件是哪里来的呢？npm又是怎么知道这些软链接是指向哪里呢？</p><p>我们可以直接在项目根目录下的<em><strong>package-lock.json文件里搜索vite.js</strong></em>，可以看到npm在install的时候，就将bin/vite.js作为bin声明了：</p><div class="language-json"><pre><code><span class="token property">&quot;bin&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
	<span class="token property">&quot;vite&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bin/vite.js&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>因此在npm安装的时候，就把bin/vite.js文件软链接到了./node_modules/.bin 目录下，而npm 还会自动把node_modules/.bin加入$PATH 变量内，这样vite就可以不用全局安装了，直接作为命令来运行、开发依赖程序。也就是说，软链接相当于是一种映射，在执行npm run xxx的时候，就会到node_modules/.bin目录里找到对应的映射文件，然后再找到相对应的js文件来执行。</p><p>而如果我们想不用软链接的方式，直接使用全局安装的命令的话，我们就需要在安装包的时候，使用npm install -g xxx来安装这个依赖，那么就会将xxx其中的bin文件加入到全局中；这样就可以和node一样，直接使用诸如xxx build这样的命令了。</p></div></div><footer class="page-footer" data-v-8fcebc32 data-v-5c96fb00><div class="edit" data-v-5c96fb00><div class="edit-link" data-v-5c96fb00 data-v-55695e90><!----></div></div><div class="updated" data-v-5c96fb00><!----></div></footer><!----><!--[--><!--[--><!----><!--]--><!--[--><!----><!--]--><!--]--></div></main></div><!----><!--]--><footer data-v-c1f40558> Copyright © 2019-2022 | MIT License </footer><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"readme.md\":\"849cd169\",\"archives.md\":\"485d3d9f\",\"index.md\":\"5413b965\",\"posts_ajax.md\":\"d41fb002\",\"posts_git.md\":\"51bcdb97\",\"posts_react.md\":\"fbe7f0cb\",\"posts_es6模块化.md\":\"5261bc18\",\"posts_npm使用手册.md\":\"d8061f3c\",\"posts_npm命令发生的事.md\":\"4f1129ec\",\"posts_vue3快速上手.md\":\"cdeb2953\",\"posts_wechat-01.md\":\"c170829a\",\"posts_wechat-02.md\":\"cb7ff986\",\"posts_wechat-03.md\":\"fe0d55d5\",\"posts_wechat-04.md\":\"797aa61a\",\"posts_wechat-05.md\":\"10d2a821\",\"posts_前端常见面试题总结.md\":\"7cf35d1e\",\"posts_吴雨豪面试题详解.md\":\"c98758c7\",\"posts_微信小程序封装请求响应拦截器.md\":\"994e234a\",\"posts_第二次面试问题：.md\":\"9e3ebcd4\",\"tags.md\":\"ab596d1b\"}")</script>
    <script type="module" async src="/KBLOG_2/assets/app.bb1174c4.js"></script>
    
  </body>
</html>